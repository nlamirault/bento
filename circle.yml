machine:
  services:
    - docker
  environment:
    PACKER_VERSION: 0.8.6

general:
  branches:
    ignore:
      - gh-pages # list of branches to ignore

dependencies:
  pre:
    - >
      sudo apt-get install -qq wget unzip &&
      pushd /usr/bin &&
      echo "Downloading packer ${PACKER_VERSION}..." &&
      sudo wget --no-verbose https://dl.bintray.com/mitchellh/packer/packer_${PACKER_VERSION}_linux_amd64.zip &&
      echo "Installing packer ${PACKER_VERSION}..." &&
      sudo unzip packer_${PACKER_VERSION}_linux_amd64.zip &&
      sudo rm packer_${PACKER_VERSION}_linux_amd64.zip

test:
  override:
    - packer validate archlinux.json
    - packer validate debian-8.0-amd64.json
    - packer validate debian-8.1-amd64.json
    - packer validate debian-8.2-amd64.json

# deployment:
#   release:
#     tag: /[0-9]+(\.[0-9]+)*/
#     owner: circleci
#     commands:
#       - make push template=jessie
#       - make push template=archlinux
#       - make push template=kali
